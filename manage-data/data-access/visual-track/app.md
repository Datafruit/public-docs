# APP可视化埋点

### 1. 进入埋点页面

#### 1.1 可视化埋点项目配置

* 进入`数据管理`->`项目列表`->`数据接入`界面

* 点击“编辑”，然后点击`修改`，弹出可修改应用信息的弹窗，可用于修改当前应用的名称，从而通过主分析表识别应用。


#### 1.2 进入可视化埋点模式

* 进入`数据管理`->`项目列表`->`数据接入`界面，如下图

![](/assets/app-maidian/1.png)

* 点击“编辑”，然后点击 `可视化埋点`（若界面中`可视化埋点`按钮不存在，请先点击`检测SDK安装状态`按钮），进入埋点页面，扫描页面上的二维码即可进入以下页面：

![](/assets/app-maidian/2.png)

* 点击 `打开app`，然后手机上集成了SDK的App就会打开，接入数据的界面上就会进入了App的页面。这时，就可以开始进行可视化埋点的部署了。

### 2. 埋点页面说明

![](/assets/app-maidian/3.png)

#### 2.1 页面设置

页面设置 如上图`1`，用于配置页面的名称，对于H5页面，还包括配置H5页面名称，H5页面加载完成注入的js代码

#### 2.2 事件设置

事件设置如上图`2`，用于事件绑定配置，除了配置事件名称外还能配置自定义维度，对于H5事件，还可以注入代码

#### 2.3 圈选区域

圈选区域如上图`3`, 用于选择需要绑定的控件，在iOS或者Android原生控件下的自定义维度模式下，用于添加自定义维度

#### 2.4 部署与测试

部署与测试如上图`4`，点击测试后，界面能实时看到App上报的数据，用户可以点击已经埋点的控件，以验证埋点是否正确。点击部署后，埋点正式生效

#### 2.5 事件列表

事件列表如上图`5`，显示所有已经埋点的事件

### 3. 埋点操作

#### 3.1 创建事件

![](/assets/app-maidian/4.png)

点击需要埋点的控件，接着输入绑定的事件名，点击保存。新的事件就可以在‘事件列表’看到。

#### 3.2 测试事件

点击‘测试’后，点击已经埋点的控件，埋点页面上就会弹出事件信息!   
![](/assets/app-maidian/5.png)

### 4. 部署事件

点击‘部署’后，事件正式生效，用于埋点的app需要重新才能看到效果

### 5. 页面名称与页面注入代码

![](/assets/app-maidian/6.png)

* “页面名称”为当前窗口名称，Android指的是当前Activity,iOS指的是当前UIViewController；
* “H5页面名称”指的是Webview中当前显示的H5页面的名称；
* “注入H5代码”是在页面加载完成后注入并执行的代码。

### 6. 原生控件事件自定义维度

![](/assets/app-maidian/7.png)

原生控件自定义维度步骤如上图，目前只支持获取控件的文本

### 7. H5元素事件注入代码

![](/assets/app-maidian/8.png)

H5事件注入代码步骤如上图。注入的代码主要用于获取H5元素相关的内容信息，所以返回值需为一个JSON，格式如下：

```
{
	'维度名1': '维度值1',
	'维度名2': '维度值2',
}。
```

### 8. H5元素同类元素绑定

同类元素是指`css path`除了顺序不一样，其他都一样的元素，通常为同层级下的同种元素，如商品列表下的商品，当对其中一个商品进行埋点时，点击其他商品同样会触发相同的事件.

### 9. 埋点注意事项

##### 9.1 iOS

对于iOS的埋点，只要是符合以下条件的控件，都可被可视化埋点：
* 所有`UIControl`类及其子类；
* `delegate`属性被指定的所有`UITableView`类及其子类；
* `delegate`属性被指定的，且按照开发者文档正确调用了以下方法的所有`UIWebView`类及其子类下的`<div/>`元素；
```
webView(_:shouldStartLoadWith:navigationType:)
webViewDidStartLoad(_:)
webViewDidFinishLoad(_:)
```
* 所有`WKWebView`类及其子类下的`<div/>`元素；

备注： 对于`UITableView`控件，`UITableViewCell`内的自定义控件，若无法通过可视化埋点圈选，则建议使用代码埋点实现数据跟踪。

##### 9.2 Android

对于Android的埋点，只要是符合以下条件的控件，都可被可视化埋点：
* `android.view.View` 类及其子类;
* `isClickable`为`true`(或者设置了`setOnClickListener`）;
* `android.webkit.WebView`类及其子类下的`<div/>`元素；


